{% extends "base.html" %} {% block content %}

<!-- BANNER -->
<section
  class="section-hero overlay inner-page bg-image"
  id="home-section"
  style="background-image: url({{ url_for('static', filename='img/susan-yin-2JIvboGLeho-unsplash.jpg')}})"
>
  <div class="container">
    <div class="row">
      <div class="col-md-7">
        <h1 class="text-white font-weight-bold">Post A Job</h1>
        <div class="custom-breadcrumbs">
          <a href="{{url_for('index')}}">Home</a>
          <span class="mx-2 slash">/</span>
          <span class="text-white"><strong>Create Post</strong></span>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- CREATE POST FORM -->
<section class="site-section">
  <div class="container">
    <div class="row align-items-center mb-5">
      <div class="col-lg-8 mb-4 mb-lg-0">
        <div class="d-flex align-items-center">
          <div>
            <h2>Share your material</h2>
            <p>
              If scanning is required, Please scan your document below before
              entering the title and description*
            </p>
          </div>
        </div>
      </div>
    </div>
    {% if error %}
    <div class="alert alert-danger"><strong>Warning!</strong> {{error}}</div>
    {% endif %} {% if info %}
    <div class="alert alert-success"><strong>Success!</strong> {{info}}.</div>
    {% endif %}
    <form
      method="POST"
      action="{{url_for('post.create_post')}}"
      id="create-post"
    >
      <div class="row mb-5">
        <div class="col-lg-12">
          <div class="form-group">
            <label for="post-title">Title</label>
            <input
              type="text"
              class="form-control"
              id="post-title"
              name="post-title"
              placeholder="Education Material Title"
              required
            />
          </div>
          <div class="form-group">
            <label for="post-description">Description</label>
            <textarea
              class="form-control"
              id="post-description"
              name="post-description"
              rows="3"
              maxlength="255"
            ></textarea>
          </div>
          <div class="form-group">
            <label for="post-content">Content</label>
            <textarea
              class="form-control"
              id="post-content"
              name="post-content"
              rows="20"
            >
            </textarea>
            <div
              id="error-note"
              class="alert alert-danger mt-4"
              role="alert"
            ></div>
          </div>
        </div>
      </div>
      <div class="row align-items-center mb-5">
        <div class="col-lg-4 ml-auto">
          <div class="row">
            <div class="text-right offset-6 col-6">
              <input
                type="hidden"
                name="csrf_token"
                id="csrf_token"
                value="{{ csrf_token() }}"
              />
              <input
                type="submit"
                id="submit"
                name="submitpost"
                value="Create Post"
                class="btn px-4 btn-primary text-white"
              />
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</section>

<!-- SCAN DOCUMENT FORM -->
<section>
  <div class="container">
    <div class="row align-items-center mb-3">
      <div class="col-lg-8 mb-4 mb-lg-0">
        <div class="d-flex align-items-center">
          <div>
            <h2>Scan your document</h2>
            <p>
              File Required OCR (Optional) <br />
              Scanned result will be display in Content text box above*
            </p>
          </div>
        </div>
      </div>
    </div>

    <form
      action="{{url_for('post.scan_document')}}"
      class="dropzone dz-clickable"
      id="my-dropzone"
    >
      <div class="dz-message d-flex flex-column">
        <i class="mr-2 icon-download" style="vertical-align: inherit"></i>
        <p class="mt-3">Drag &amp; Drop here or click</p>
      </div>

      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    </form>

    <div class="row align-items-center my-3">
      <div class="col-lg-4 ml-auto">
        <div class="row">
          <div class="text-right offset-6 col-6">
            <input
              type="button"
              id="dropzoneSubmit"
              value="Scan Document"
              class="btn px-4 btn-primary text-white"
            />
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  
  $(document).ready(function () {
    // Create alphanumeric validator and common symbol validator
    jQuery.validator.addMethod("alphanumeric", function(value, element) {
    return this.optional(element) || /^[ A-Za-z0-9~!@#$%^&*\\(\\)_+-=""'':;,<>.?/~`]+$/i.test(value);
    });

    //Create Post
    $("#error-note").hide();
    $("#create-post").validate({
      errorLabelContainer: "#error-note",
      errorElement: "div",
      rules: {
        "post-title": {
          required: true,
          maxlength: 255,
          alphanumeric: true
        }
      },
      messages: {
        "post-title": {
          required: "Please enter the education material title.",
          maxlength: "The number of character in post title exceed 255 character.",
          alphanumeric: "Letters, numbers, and common symbols only."
        }
      },
      invalidHandler: function (event, validator) {
        var errors = validator.numberOfInvalids();
        if (errors) {
          $("#error-note").show();
        } else {
          $("#error-note").text = "";
          $("#error-note").hide();
        }
      },
      submitHandler: function (form) {
        $("#error-note").text = "";
        $("#error-note").hide();
        $(form).ajaxSubmit();
      },
    });
  });

  // Drop Zone Script
  Dropzone.autoDiscover = false;
  myDropzone = new Dropzone("#my-dropzone", {
    paramName: "file",
    autoProcessQueue: false,
    uploadMultiple: true,
    parallelUploads: 5,
    maxFilesize: 20,
    maxFiles: 5,
    acceptedFiles: ".png, .jpeg, .jpg",
    addRemoveLinks: true,
    dictFileTooBig:
      "File is to big ({{filesize}}mb). Max allowed file size is {{maxFilesize}}mb",
    dictInvalidFileType: "Invalid File Type",
    dictCancelUpload: "Cancel",
    dictRemoveFile: "Remove",
    dictMaxFilesExceeded: "Only {{maxFiles}} files are allowed",
    dictDefaultMessage: "Drop files here to upload",
    init: function () {
      myDropzone = this;

      $("#dropzoneSubmit").click(function (event) {
        myDropzone.processQueue();
      });

      this.on("success", function (file, responseText) {
        $("[name = 'post-content']").val(responseText);
      });
    },
  });
</script>

{% endblock %}
